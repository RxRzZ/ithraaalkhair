<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Cards</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        fetch("./data/taskDetails.json").then(response => response.json()).then(data => {
            window["dataMapping"] = data
        });
    </script>
    <!-- Alpine.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <div x-data="{ tasks: [] }" x-init="fetch('tasks.json')
            .then(response => response.json())
            .then(data => {
            tasks = [...data.sort((a, b) => new Date(a.end_date) - new Date(b.end_date))].filter((itm)=> itm.business_model == 'B2B')
            })">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="task in tasks" :key="task.id">
                    <div @click="console.log(dataMapping.find(i => i.id== task.id))" :class="{'bg-white': true, '!bg-green-200': task.is_approved == 'APPROVED', '!bg-red-200': task.is_approved == 'NONAPPROVED'}" class="flex flex-col  justify-between hover:shadow-lg justify-between p-6 rounded-lg shadow-md transition-shadow">
                        <div>
                            <h2 class="text-xl font-bold mb-2" x-text="task.name"></h2>
                            <div class="text-gray-600 mb-2" x-text="task.id"></div>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-sm" x-text="task.phase_category"></span>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-sm" x-text="task.business_model"></span>
                            </div>
                            <span class="font-semibold">الوصف:</span>
                            <p x-text="dataMapping.find(i => i.id== task.id).description"></p>
                            <br />
                        </div>

                        <div class="text-sm text-gray-500">
                            <!--<p><span class="font-semibold">Urgency:</span> <span x-text="task.urgency_status"></span></p>
                            <p><span class="font-semibold">Service:</span> <span x-text="task.service"></span></p>
                            <p><span class="font-semibold">Season:</span> <span x-text="task.season"></span></p>-->
                            <span class="font-semibold">الاسئلة:</span>
                            <template x-for="q in dataMapping.find(i => i.id== task.id).questions" :key="q.question">
                                <p x-text="q.question"></p>
                            </template>
                            <div class="mt-3 pt-3 border-t border-gray-200">
                                <p><span class="font-semibold">البدأ:</span> <span x-text="task.start_date"></span> | <span x-text="new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', { day: 'numeric', month: 'numeric', year: 'numeric' }).format(new Date(task.start_date))"></span></p>
                                <p>
                                    <span class="font-semibold">الانتهاء:</span> 
                                    <span x-bind:class="{ 'text-red-600 font-bold': new Date(task.end_date) < new Date() }">
                                        <span x-text="task.end_date"></span> | 
                                        <span x-text="new Intl.DateTimeFormat('ar-SA-u-ca-islamic-umalqura', { day: 'numeric', month: 'numeric', year: 'numeric' }).format(new Date(task.end_date))"></span>
                                    </span>
                                </p>
                                
                            </div>
                            <div class="bg-grey-100 text-center mt-2 rounded-lg p-2">
                                <a x-show="dataMapping.find(i => i.id== task.id)?.guide_file.file_name" :href="dataMapping.find(i => i.id== task.id)?.guide_file.file_url" x-text="(dataMapping.find(i => i.id== task.id)?.guide_file.file_name).replaceAll('_', ' ')" 
                                    class="text-wrap text-red-500 underline hover:decoration-orange-800 wrap-anywhere">
                                </a>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>
</body>
</html>
